<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>太虚仙门 · 问道长生</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
theme: {
extend: {
colors: {
ink: '#0a0e14',
paper: '#f5f0e6',
vermilion: '#c53d43',
jade: '#5a7e7a',
gold: '#d4a853',
azure: '#4a6fa5',
mystic: '#2d3a4a',
spirit: '#7eb8a2',
}
}
}
}
</script>
<link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
--bg-primary: #0a0e14;
--bg-secondary: #141b24;
--text-primary: #f5f0e6;
--text-secondary: #a8a095;
--accent-gold: #d4a853;
--accent-jade: #5a7e7a;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { 
font-family: 'Noto Serif SC', serif; 
background: var(--bg-primary);
color: var(--text-primary);
overflow-x: hidden;
line-height: 1.6;
min-height: 100vh;
}
.font-brush { font-family: 'Ma Shan Zheng', cursive; }

/* 背景效果 */
.bg-pattern {
position: fixed;
inset: 0;
z-index: 0;
pointer-events: none;
background: 
radial-gradient(ellipse at 20% 20%, rgba(90, 126, 122, 0.1) 0%, transparent 50%),
radial-gradient(ellipse at 80% 80%, rgba(212, 168, 83, 0.08) 0%, transparent 50%),
linear-gradient(180deg, rgba(10, 14, 20, 0.9) 0%, rgba(20, 27, 36, 0.95) 100%);
}

.stars {
position: fixed;
inset: 0;
z-index: 0;
pointer-events: none;
background-image: 
radial-gradient(2px 2px at 20px 30px, #eee, transparent),
radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
radial-gradient(1px 1px at 90px 40px, #fff, transparent),
radial-gradient(2px 2px at 160px 120px, rgba(255,255,255,0.6), transparent);
background-size: 200px 200px;
animation: twinkle 4s ease-in-out infinite;
}

@keyframes twinkle {
0%, 100% { opacity: 0.5; }
50% { opacity: 1; }
}

/* 动画 */
@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
0%, 100% { opacity: 0.8; }
50% { opacity: 1; }
}

@keyframes rotate {
from { transform: rotate(0deg); }
to { transform: rotate(360deg); }
}

.animate-fade { animation: fadeIn 0.6s ease-out; }

/* 卡片 */
.glass-card {
background: linear-gradient(135deg, rgba(20, 27, 36, 0.9) 0%, rgba(10, 14, 20, 0.95) 100%);
backdrop-filter: blur(10px);
border: 1px solid rgba(212, 168, 83, 0.2);
border-radius: 12px;
box-shadow: 0 8px 32px rgba(0,0,0,0.3);
transition: all 0.3s ease;
}

.glass-card:hover {
border-color: rgba(212, 168, 83, 0.4);
transform: translateY(-2px);
box-shadow: 0 12px 40px rgba(0,0,0,0.4);
}

/* 按钮 */
.btn-gold {
background: linear-gradient(135deg, rgba(212, 168, 83, 0.25), rgba(212, 168, 83, 0.15));
border: 1px solid rgba(212, 168, 83, 0.5);
color: var(--accent-gold);
padding: 12px 28px;
border-radius: 8px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
display: inline-flex;
align-items: center;
gap: 8px;
}

.btn-gold:hover {
background: linear-gradient(135deg, rgba(212, 168, 83, 0.35), rgba(212, 168, 83, 0.25));
box-shadow: 0 0 25px rgba(212, 168, 83, 0.3);
transform: translateY(-2px);
}

.btn-jade {
background: linear-gradient(135deg, rgba(90, 126, 122, 0.25), rgba(90, 126, 122, 0.15));
border: 1px solid rgba(90, 126, 122, 0.5);
color: var(--accent-jade);
padding: 10px 24px;
border-radius: 8px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
display: inline-flex;
align-items: center;
gap: 8px;
}

.btn-jade:hover {
background: linear-gradient(135deg, rgba(90, 126, 122, 0.35), rgba(90, 126, 122, 0.25));
box-shadow: 0 0 20px rgba(90, 126, 122, 0.3);
}

/* 导航 */
.nav-link {
position: relative;
padding: 8px 16px;
color: var(--text-secondary);
transition: all 0.3s ease;
cursor: pointer;
border-radius: 6px;
}

.nav-link:hover, .nav-link.active {
color: var(--accent-gold);
background: rgba(212, 168, 83, 0.1);
}

.nav-link.active {
background: rgba(212, 168, 83, 0.15);
}

/* 太极图 */
.taiji {
width: 60px;
height: 60px;
border-radius: 50%;
background: linear-gradient(to right, #f5f0e6 50%, #1a1a1a 50%);
position: relative;
animation: rotate 30s linear infinite;
}

.taiji::before, .taiji::after {
content: '';
position: absolute;
width: 30px;
height: 30px;
border-radius: 50%;
}

.taiji::before {
background: #f5f0e6;
top: 0;
left: 50%;
transform: translateX(-50%);
}

.taiji::after {
background: #1a1a1a;
bottom: 0;
left: 50%;
transform: translateX(-50%);
}

/* 引用 */
.quote {
border-left: 3px solid var(--accent-gold);
padding-left: 16px;
color: var(--text-secondary);
font-style: italic;
margin: 16px 0;
}

/* 页面容器 */
.page {
display: none;
opacity: 0;
min-height: calc(100vh - 140px);
}

.page.active {
display: block;
animation: fadeIn 0.5s ease-out forwards;
}

/* 滚动条 */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-secondary); }
::-webkit-scrollbar-thumb { background: var(--accent-jade); border-radius: 3px; }

/* 功能卡片 */
.feature-card {
background: linear-gradient(135deg, rgba(30, 40, 50, 0.8), rgba(20, 30, 40, 0.9));
border: 1px solid rgba(212, 168, 83, 0.15);
border-radius: 12px;
padding: 24px;
transition: all 0.3s ease;
cursor: pointer;
}

.feature-card:hover {
border-color: rgba(212, 168, 83, 0.4);
transform: translateY(-4px);
box-shadow: 0 15px 40px rgba(0,0,0,0.4);
}

/* 响应式 */
@media (max-width: 768px) {
.taiji { width: 40px; height: 40px; }
.taiji::before, .taiji::after { width: 20px; height: 20px; }
.nav-desktop { display: none !important; }
.mobile-menu-btn { display: flex !important; }
}

@media (min-width: 769px) {
.mobile-menu-btn { display: none !important; }
.mobile-nav { display: none !important; }
}

/* 进度条 */
.progress-bar {
height: 8px;
background: rgba(26, 26, 26, 0.5);
border-radius: 4px;
overflow: hidden;
}

.progress-fill {
height: 100%;
background: linear-gradient(90deg, var(--accent-jade), var(--accent-gold));
border-radius: 4px;
transition: width 0.5s ease;
}

/* 弹窗 */
.modal {
position: fixed;
inset: 0;
z-index: 100;
display: none;
align-items: center;
justify-content: center;
padding: 16px;
}

.modal.show {
display: flex;
}

.modal-bg {
position: absolute;
inset: 0;
background: rgba(10, 14, 20, 0.95);
backdrop-filter: blur(8px);
}

.modal-content {
position: relative;
z-index: 1;
max-width: 600px;
width: 100%;
max-height: 90vh;
overflow-y: auto;
}
</style>
</head>
<body>
<div class="bg-pattern"></div>
<div class="stars"></div>

<div class="relative z-10 min-h-screen flex flex-col">
<!-- 顶部导航 -->
<header class="sticky top-0 z-50 glass-card mx-2 md:mx-4 mt-2 md:mt-3 rounded-xl">
<div class="max-w-7xl mx-auto px-3 md:px-6 py-3 flex items-center justify-between">
<div class="flex items-center gap-3 cursor-pointer" onclick="showPage('home')">
<div class="taiji w-8 h-8 md:w-10 md:h-10"></div>
<h1 class="font-brush text-xl md:text-2xl text-gold">太虚仙门</h1>
</div>

<nav class="nav-desktop hidden md:flex items-center gap-2">
<a class="nav-link active" onclick="showPage('home')">首页</a>
<a class="nav-link" onclick="showPage('realm')">境界体系</a>
<a class="nav-link" onclick="showPage('technique')">功法秘籍</a>
<a class="nav-link" onclick="showPage('alchemy')">丹药宝典</a>
<a class="nav-link" onclick="showPage('health')">养生之道</a>
<a class="nav-link" onclick="showPage('legend')">神仙列传</a>
<a class="nav-link" onclick="showPage('practice')">修行中心</a>
<a class="nav-link" onclick="showPage('trial')">试炼场</a>
</nav>

<button class="mobile-menu-btn hidden w-10 h-10 rounded-lg bg-gold/10 border border-gold/30 text-gold items-center justify-center" onclick="toggleMobileMenu()">
<i class="fas fa-bars"></i>
</button>
</div>
</header>

<!-- 移动端菜单 -->
<div id="mobileNav" class="mobile-nav fixed inset-0 z-50 hidden">
<div class="absolute inset-0 bg-ink/98" onclick="toggleMobileMenu()"></div>
<div class="relative z-10 h-full flex flex-col items-center justify-center gap-4 p-6">
<button onclick="toggleMobileMenu()" class="absolute top-4 right-4 w-10 h-10 rounded-lg bg-paper/10 text-paper text-xl">
<i class="fas fa-times"></i>
</button>
<a class="nav-link text-xl font-brush" onclick="showPage('home'); toggleMobileMenu();">首页</a>
<a class="nav-link text-xl font-brush" onclick="showPage('realm'); toggleMobileMenu();">境界体系</a>
<a class="nav-link text-xl font-brush" onclick="showPage('technique'); toggleMobileMenu();">功法秘籍</a>
<a class="nav-link text-xl font-brush" onclick="showPage('alchemy'); toggleMobileMenu();">丹药宝典</a>
<a class="nav-link text-xl font-brush" onclick="showPage('health'); toggleMobileMenu();">养生之道</a>
<a class="nav-link text-xl font-brush" onclick="showPage('legend'); toggleMobileMenu();">神仙列传</a>
<a class="nav-link text-xl font-brush" onclick="showPage('practice'); toggleMobileMenu();">修行中心</a>
<a class="nav-link text-xl font-brush" onclick="showPage('trial'); toggleMobileMenu();">试炼场</a>
</div>
</div>

<!-- 主内容区 -->
<main class="flex-1 px-2 md:px-4 py-4 md:py-6">
<!-- 首页 -->
<div id="page-home" class="page active max-w-7xl mx-auto">
<div class="grid lg:grid-cols-2 gap-6 md:gap-10 items-center mb-8 md:mb-12">
<div class="space-y-5 animate-fade">
<div>
<p class="text-jade text-sm mb-2 tracking-widest">问道长生 · 修真入门</p>
<h2 class="font-brush text-3xl md:text-5xl text-paper leading-tight">
天地有大美<br/><span class="text-gold">修真可长生</span>
</h2>
</div>
<div class="quote text-sm md:text-base">
<p class="mb-2 font-brush text-gold">「抱朴子曰：」</p>
<p>夫求长生，修至道，诀在于志，不在于富贵名利。</p>
</div>
<div class="flex flex-wrap gap-3">
<button class="btn-gold" onclick="showPage('practice')">
<i class="fas fa-om"></i>开始修行
</button>
<button class="btn-jade" onclick="showPage('realm')">
<i class="fas fa-mountain"></i>了解境界
</button>
</div>
</div>
<div class="flex justify-center">
<div class="relative">
<div class="w-40 md:w-52 h-40 md:h-52 rounded-full border border-gold/30 flex items-center justify-center">
<div class="taiji"></div>
</div>
</div>
</div>
</div>

<!-- 功能入口 -->
<div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
<div class="feature-card" onclick="showPage('realm')">
<div class="text-jade text-2xl mb-3"><i class="fas fa-mountain"></i></div>
<h3 class="font-brush text-xl text-paper mb-2">境界体系</h3>
<p class="text-paper/60 text-sm">由凡入仙，历经七大境界</p>
</div>
<div class="feature-card" onclick="showPage('technique')">
<div class="text-gold text-2xl mb-3"><i class="fas fa-scroll"></i></div>
<h3 class="font-brush text-xl text-paper mb-2">功法秘籍</h3>
<p class="text-paper/60 text-sm">修炼之法，择一而修</p>
</div>
<div class="feature-card" onclick="showPage('alchemy')">
<div class="text-vermilion text-2xl mb-3"><i class="fas fa-mortar-pestle"></i></div>
<h3 class="font-brush text-xl text-paper mb-2">丹药宝典</h3>
<p class="text-paper/60 text-sm">灵丹妙药，助益修行</p>
</div>
<div class="feature-card" onclick="showPage('practice')">
<div class="text-spirit text-2xl mb-3"><i class="fas fa-om"></i></div>
<h3 class="font-brush text-xl text-paper mb-2">修行中心</h3>
<p class="text-paper/60 text-sm">打坐冥想，突破境界</p>
</div>
</div>

<!-- 今日运势 -->
<div class="glass-card p-5 md:p-6">
<h3 class="font-brush text-lg md:text-xl text-paper mb-4 text-center">今日修真运势</h3>
<div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-center">
<div class="p-3 md:p-4 rounded-xl bg-jade/10 border border-jade/20">
<div class="text-jade text-xl mb-1"><i class="fas fa-sun"></i></div>
<div class="text-paper/70 text-xs mb-1">宜修炼</div>
<div class="text-jade font-brush">吐纳打坐</div>
</div>
<div class="p-3 md:p-4 rounded-xl bg-gold/10 border border-gold/20">
<div class="text-gold text-xl mb-1"><i class="fas fa-mortar-pestle"></i></div>
<div class="text-paper/70 text-xs mb-1">宜炼丹</div>
<div class="text-gold font-brush">聚气丹</div>
</div>
<div class="p-3 md:p-4 rounded-xl bg-vermilion/10 border border-vermilion/20">
<div class="text-vermilion text-xl mb-1"><i class="fas fa-bolt"></i></div>
<div class="text-paper/70 text-xs mb-1">忌</div>
<div class="text-vermilion font-brush">动武争斗</div>
</div>
<div class="p-3 md:p-4 rounded-xl bg-azure/10 border border-azure/20">
<div class="text-azure text-xl mb-1"><i class="fas fa-star"></i></div>
<div class="text-paper/70 text-xs mb-1">机缘</div>
<div class="text-azure font-brush">遇贵人</div>
</div>
</div>
</div>

<!-- 名言 -->
<div class="mt-6 p-5 rounded-xl bg-gold/5 border-l-4 border-gold">
<p class="text-paper/80 text-center text-sm md:text-base">「道可道，非常道；名可名，非常名。」</p>
<p class="text-gold text-xs text-center mt-2">——《道德经》</p>
</div>
</div>

<!-- 境界体系页 -->
<div id="page-realm" class="page max-w-7xl mx-auto">
<div class="text-center mb-6">
<h2 class="font-brush text-2xl md:text-3xl text-paper mb-2">修真境界体系</h2>
<p class="text-paper/60 text-sm">由凡入仙，历经七大境界</p>
</div>

<!-- 五脏对应 -->
<div class="glass-card p-5 mb-6">
<h3 class="font-brush text-lg text-paper mb-4 text-center">五脏对应境界</h3>
<div class="grid grid-cols-5 gap-2">
<div class="text-center p-2 md:p-3 rounded-xl bg-jade/10 border border-jade/20 cursor-pointer hover:bg-jade/20" onclick="showOrganModal('lung')">
<i class="fas fa-lungs text-jade text-lg"></i>
<div class="text-jade text-xs mt-1">肺·金</div>
<div class="text-paper/50 text-xs">炼气期</div>
</div>
<div class="text-center p-2 md:p-3 rounded-xl bg-azure/10 border border-azure/20 cursor-pointer hover:bg-azure/20" onclick="showOrganModal('kidney')">
<i class="fas fa-kidneys text-azure text-lg"></i>
<div class="text-azure text-xs mt-1">肾·水</div>
<div class="text-paper/50 text-xs">筑基期</div>
</div>
<div class="text-center p-2 md:p-3 rounded-xl bg-vermilion/10 border border-vermilion/20 cursor-pointer hover:bg-vermilion/20" onclick="showOrganModal('heart')">
<i class="fas fa-heart text-vermilion text-lg"></i>
<div class="text-vermilion text-xs mt-1">心·火</div>
<div class="text-paper/50 text-xs">金丹期</div>
</div>
<div class="text-center p-2 md:p-3 rounded-xl bg-spirit/10 border border-spirit/20 cursor-pointer hover:bg-spirit/20" onclick="showOrganModal('liver')">
<i class="fas fa-liver text-spirit text-lg"></i>
<div class="text-spirit text-xs mt-1">肝·木</div>
<div class="text-paper/50 text-xs">元婴期</div>
</div>
<div class="text-center p-2 md:p-3 rounded-xl bg-gold/10 border border-gold/20 cursor-pointer hover:bg-gold/20" onclick="showOrganModal('spleen')">
<i class="fas fa-stomach text-gold text-lg"></i>
<div class="text-gold text-xs mt-1">脾·土</div>
<div class="text-paper/50 text-xs">化神期</div>
</div>
</div>
</div>

<!-- 境界列表 -->
<div class="space-y-4" id="realmList"></div>
</div>

<!-- 功法秘籍页 -->
<div id="page-technique" class="page max-w-7xl mx-auto">
<div class="text-center mb-6">
<h2 class="font-brush text-2xl md:text-3xl text-paper mb-2">功法秘籍</h2>
<p class="text-paper/60 text-sm">择一而修，持之以恒</p>
</div>

<div class="flex flex-wrap justify-center gap-2 mb-6">
<button class="px-4 py-2 rounded-lg border border-gold/30 text-gold bg-gold/10" onclick="showTechniqueTab('basic')">基础功法</button>
<button class="px-4 py-2 rounded-lg border border-paper/20 text-paper/60 hover:border-gold/30" onclick="showTechniqueTab('advanced')">进阶功法</button>
<button class="px-4 py-2 rounded-lg border border-paper/20 text-paper/60 hover:border-gold/30" onclick="showTechniqueTab('special')">特殊法门</button>
</div>

<div id="techniqueContent"></div>
</div>

<!-- 丹药宝典页 -->
<div id="page-alchemy" class="page max-w-7xl mx-auto">
<div class="text-center mb-6">
<h2 class="font-brush text-2xl md:text-3xl text-paper mb-2">丹药宝典</h2>
<p class="text-paper/60 text-sm">灵丹妙药，助益修行</p>
</div>

<div class="flex flex-wrap justify-center gap-2 mb-6">
<button class="px-4 py-2 rounded-lg border border-gold/30 text-gold bg-gold/10" onclick="showAlchemyTab('dans')">灵丹妙药</button>
<button class="px-4 py-2 rounded-lg border border-paper/20 text-paper/60 hover:border-gold/30" onclick="showAlchemyTab('herbs')">天材地宝</button>
<button class="px-4 py-2 rounded-lg border border-paper/20 text-paper/60 hover:border-gold/30" onclick="showAlchemyTab('formulas')">丹方秘录</button>
</div>

<div id="alchemyContent"></div>
</div>

<!-- 养生之道页 -->
<div id="page-health" class="page max-w-7xl mx-auto">
<div class="text-center mb-6">
<h2 class="font-brush text-2xl md:text-3xl text-paper mb-2">养生之道</h2>
<p class="text-paper/60 text-sm">顺应天时，调和阴阳</p>
</div>

<div id="healthContent"></div>
</div>

<!-- 神仙列传页 -->
<div id="page-legend" class="page max-w-7xl mx-auto">
<div class="text-center mb-6">
<h2 class="font-brush text-2xl md:text-3xl text-paper mb-2">神仙列传</h2>
<p class="text-paper/60 text-sm">观其生平，悟其道心</p>
</div>

<div class="grid md:grid-cols-2 gap-4" id="legendList"></div>
</div>

<!-- 修行中心页 -->
<div id="page-practice" class="page max-w-7xl mx-auto">
<div class="text-center mb-6">
<h2 class="font-brush text-2xl md:text-3xl text-paper mb-2">修行中心</h2>
<p class="text-paper/60 text-sm">每日勤修，必有精进</p>
</div>

<div class="grid lg:grid-cols-3 gap-5">
<div class="lg:col-span-2 space-y-5">
<!-- 当前境界 -->
<div class="glass-card p-5">
<div class="flex items-center justify-between mb-4">
<h3 class="font-brush text-lg text-paper">当前境界</h3>
<button class="text-gold text-xs" onclick="showRealmInfo()">
<i class="fas fa-info-circle mr-1"></i>详情
</button>
</div>
<div class="flex items-center gap-4 mb-4">
<div class="w-16 h-16 rounded-full bg-jade/20 flex items-center justify-center border-2 border-jade/30">
<span class="font-brush text-2xl text-jade" id="realmIcon">气</span>
</div>
<div class="flex-grow">
<h4 class="font-brush text-lg text-paper">炼气期 <span class="text-jade text-xs px-2 py-1 rounded-full bg-jade/10">初期</span></h4>
<p class="text-paper/60 text-sm">引天地灵气入体，开辟丹田</p>
</div>
</div>
<div class="space-y-2 mb-4">
<div class="flex justify-between text-xs">
<span class="text-paper/70">修炼进度</span>
<span class="text-gold" id="progressText">35%</span>
</div>
<div class="progress-bar">
<div class="progress-fill" id="progressBar" style="width: 35%"></div>
</div>
</div>
<div class="grid grid-cols-3 gap-3 text-center">
<div class="p-3 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs mb-1">灵力</div>
<div class="text-jade text-lg font-brush" id="spiritPower">1,250</div>
</div>
<div class="p-3 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs mb-1">修炼时辰</div>
<div class="text-gold text-lg font-brush" id="practiceHours">128</div>
</div>
<div class="p-3 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs mb-1">突破次数</div>
<div class="text-spirit text-lg font-brush" id="breakthroughs">3</div>
</div>
</div>
</div>

<!-- 打坐冥想 -->
<div class="glass-card p-5">
<div class="flex items-center justify-between mb-4">
<h3 class="font-brush text-lg text-paper">打坐冥想</h3>
<span id="meditationStatus" class="text-jade text-xs">待机中</span>
</div>
<div class="text-center py-6">
<div class="text-3xl md:text-4xl font-brush mb-4" id="meditationTimer">00:00:00</div>
<div class="flex justify-center gap-3">
<button class="btn-jade" id="startMeditation" onclick="startMeditation()">
<i class="fas fa-play"></i>开始冥想
</button>
<button class="btn-jade opacity-50" id="stopMeditation" disabled onclick="stopMeditation()">
<i class="fas fa-stop"></i>结束冥想
</button>
</div>
</div>
<div class="p-3 rounded-lg bg-ink/30">
<h4 class="text-gold text-xs mb-2">冥想要诀</h4>
<p class="text-paper/60 text-xs">盘膝而坐，双手结印，闭目调息。吸气观想天地灵气从百会穴入体，呼气观想浊气从涌泉穴排出。</p>
</div>
</div>
</div>

<!-- 右侧 -->
<div class="space-y-5">
<div class="glass-card p-4">
<h3 class="font-brush text-base text-paper mb-3">灵根测试</h3>
<p class="text-paper/60 text-xs mb-3">测试你的修行资质</p>
<button class="btn-gold w-full text-sm" onclick="startRootTest()">
<i class="fas fa-search mr-2"></i>开始测试
</button>
</div>
<div class="glass-card p-4">
<h3 class="font-brush text-base text-paper mb-3">每日修行</h3>
<div class="space-y-2" id="dailyTasks"></div>
</div>
<div class="glass-card p-4">
<h3 class="font-brush text-base text-paper mb-3">修行记录</h3>
<div class="space-y-2 max-h-32 overflow-y-auto" id="practiceLog"></div>
</div>
</div>
</div>
</div>

<!-- 试炼场页 -->
<div id="page-trial" class="page max-w-7xl mx-auto">
<div class="text-center mb-6">
<h2 class="font-brush text-2xl md:text-3xl text-paper mb-2">试炼场</h2>
<p class="text-paper/60 text-sm">磨砺神识，测试资质</p>
</div>

<div class="grid md:grid-cols-2 gap-5">
<!-- 反应测试 -->
<div class="glass-card p-5">
<h3 class="font-brush text-lg text-paper mb-3 text-center">神识反应</h3>
<p class="text-paper/60 text-center mb-4 text-sm">点击出现的灵光目标</p>
<div id="reactionGame" class="relative bg-ink/50 rounded-xl h-48 overflow-hidden border border-jade/20">
<div class="absolute inset-0 flex items-center justify-center">
<p id="reactionStatus" class="text-paper/50 text-sm">点击开始按钮测试</p>
</div>
<div id="reactionTarget" style="display:none;position:absolute;width:50px;height:50px;border-radius:50%;background:radial-gradient(circle,#d4a853,#c53d43);cursor:pointer;box-shadow:0 0 20px rgba(212,168,83,0.5);"></div>
</div>
<div class="mt-4 flex justify-center gap-3">
<button class="btn-jade" id="startReaction" onclick="startReactionGame()">开始</button>
<button class="btn-jade opacity-50" id="stopReaction" disabled onclick="stopReactionGame()">停止</button>
</div>
<div class="mt-4 grid grid-cols-3 gap-2 text-center">
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">次数</div>
<div class="text-jade font-brush" id="reactionCount">0</div>
</div>
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">平均</div>
<div class="text-gold font-brush" id="avgReaction">--</div>
</div>
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">评级</div>
<div class="text-spirit font-brush" id="reactionRank">未测试</div>
</div>
</div>
</div>

<!-- 定力测试 -->
<div class="glass-card p-5">
<h3 class="font-brush text-lg text-paper mb-3 text-center">定力试炼</h3>
<p class="text-paper/60 text-center mb-4 text-sm">在干扰中保持专注</p>
<div id="focusGame" class="relative bg-ink/50 rounded-xl h-48 overflow-hidden border border-azure/20">
<div class="absolute inset-0 flex items-center justify-center">
<div id="focusTarget" class="w-12 h-12 rounded-full bg-azure/30 flex items-center justify-center cursor-pointer">
<i class="fas fa-yin-yang text-azure text-xl animate-spin" style="animation-duration:4s"></i>
</div>
</div>
<div id="focusDistractions" class="absolute inset-0 pointer-events-none"></div>
</div>
<div class="mt-4 flex justify-center gap-3">
<button class="btn-jade" id="startFocus" onclick="startFocusGame()">开始</button>
<button class="btn-jade opacity-50" id="stopFocus" disabled onclick="stopFocusGame()">停止</button>
</div>
<div class="mt-4 grid grid-cols-3 gap-2 text-center">
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">时间</div>
<div class="text-azure font-brush" id="focusTime">0秒</div>
</div>
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">最高</div>
<div class="text-gold font-brush" id="focusBest">0秒</div>
</div>
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">评级</div>
<div class="text-spirit font-brush" id="focusRank">未测试</div>
</div>
</div>
</div>

<!-- 记忆测试 -->
<div class="glass-card p-5">
<h3 class="font-brush text-lg text-paper mb-3 text-center">记忆阵法</h3>
<p class="text-paper/60 text-center mb-4 text-sm">记住符文闪烁顺序</p>
<div id="memoryGame" class="grid grid-cols-4 gap-2 max-w-xs mx-auto"></div>
<div class="mt-4 flex justify-center gap-3">
<button class="btn-jade" id="startMemory" onclick="startMemoryGame()">开始</button>
<button class="btn-jade opacity-50" id="stopMemory" disabled onclick="stopMemoryGame()">停止</button>
</div>
<div class="mt-4 grid grid-cols-3 gap-2 text-center">
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">关卡</div>
<div class="text-jade font-brush" id="memoryLevel">1</div>
</div>
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">最高</div>
<div class="text-gold font-brush" id="memoryBest">0</div>
</div>
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">评级</div>
<div class="text-spirit font-brush" id="memoryRank">未测试</div>
</div>
</div>
</div>

<!-- 悟性测试 -->
<div class="glass-card p-5">
<h3 class="font-brush text-lg text-paper mb-3 text-center">悟性问答</h3>
<p class="text-paper/60 text-center mb-4 text-sm">解答道家难题</p>
<div class="p-4 rounded-xl bg-ink/30 border border-gold/20">
<p class="text-paper/80 text-sm mb-3" id="wisdomQuestion"></p>
<div class="space-y-2" id="wisdomOptions"></div>
</div>
<div class="mt-4 grid grid-cols-3 gap-2 text-center">
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">答题</div>
<div class="text-jade font-brush" id="wisdomCount">0</div>
</div>
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">正确率</div>
<div class="text-gold font-brush" id="wisdomCorrect">0%</div>
</div>
<div class="p-2 rounded-lg bg-ink/30">
<div class="text-paper/50 text-xs">评级</div>
<div class="text-spirit font-brush" id="wisdomRank">未测试</div>
</div>
</div>
</div>
</div>
</div>
</main>

<!-- 页脚 -->
<footer class="glass-card mx-2 md:mx-4 mb-2 md:mb-3 rounded-xl py-4 text-center text-paper/40 text-xs">
<p>太虚仙门 · 问道长生</p>
</footer>
</div>

<!-- 弹窗容器 -->
<div id="modal" class="modal">
<div class="modal-bg" onclick="closeModal()"></div>
<div class="modal-content glass-card p-6" id="modalContent"></div>
</div>

<script>
// 数据定义
const realmData = {
lianqi: { name:'炼气期', icon:'气', color:'jade', desc:'引天地灵气入体，开辟丹田', lifespan:'百五十载', stages:['初期(1-3层)-气感初生','中期(4-6层)-气旋初成','后期(7-9层)-气海充盈'], abilities:['感应灵气','引气入体','开辟丹田','轻身术'], next:'筑基期' },
zhuji: { name:'筑基期', icon:'基', color:'azure', desc:'气旋化液，筑建道基', lifespan:'三百载', stages:['初期-道基初成','中期-道基稳固','后期-道基圆满'], abilities:['御器飞行','神识初显','寿元大增','辟谷不食'], next:'金丹期' },
jindan: { name:'金丹期', icon:'丹', color:'gold', desc:'道基化丹，金丹大成', lifespan:'五百载', stages:['初期-金丹初凝','中期-金丹稳固','后期-金丹圆满'], abilities:['御剑飞行','神通初显','瞬息千里','寿元大增'], next:'元婴期' },
yuanying: { name:'元婴期', icon:'婴', color:'spirit', desc:'碎丹成婴，元婴出窍', lifespan:'千载', stages:['初期-元婴初生','中期-元婴成长','后期-元婴大成'], abilities:['元婴出窍','瞬移千里','分神化身','夺舍重生'], next:'化神期' },
huashen: { name:'化神期', icon:'神', color:'vermilion', desc:'元婴化神，神念通达', lifespan:'三千载', stages:['初期-神念初成','中期-神念壮大','后期-神念圆满'], abilities:['神念覆盖','法则初悟','移山填海','创造空间'], next:'返虚期' },
fanxu: { name:'返虚期', icon:'虚', color:'paper', desc:'炼神还虚，与道合真', lifespan:'万载', stages:['初期-虚空初入','中期-虚空遨游','后期-虚空大成'], abilities:['虚空遨游','法则掌控','不死不灭','创造生灵'], next:'合道期' },
hedao: { name:'合道期', icon:'道', color:'gold', desc:'身与道合，我即是道', lifespan:'与天同寿', stages:['初期-道心初合','中期-道法自然','后期-道成真仙'], abilities:['言出法随','创造世界','超脱轮回','与天同寿'], next:'飞升仙界' }
};

const organData = {
lung: { name:'肺', element:'金', color:'jade', realm:'炼气期', desc:'肺主气，司呼吸', practice:'每日清晨面向东方深呼吸' },
kidney: { name:'肾', element:'水', color:'azure', realm:'筑基期', desc:'肾主水，藏精', practice:'节制房事，按摩肾俞穴' },
heart: { name:'心', element:'火', color:'vermilion', realm:'金丹期', desc:'心主火，藏神', practice:'静心养神，意守心窍' },
liver: { name:'肝', element:'木', color:'spirit', realm:'元婴期', desc:'肝主木，藏魂', practice:'保持情绪舒畅，丑时熟睡' },
spleen: { name:'脾', element:'土', color:'gold', realm:'化神期', desc:'脾主土，藏意', practice:'饮食有节，辰时进食' }
};

const techniqueData = {
basic: [
{ name:'吐纳术', icon:'fa-wind', color:'jade', desc:'采天地之灵气，纳日月之精华', mantra:'吸气观想灵气从百会穴入，呼气浊气从涌泉穴出' },
{ name:'静心诀', icon:'fa-brain', color:'azure', desc:'心者君主之官，静心者方能入定', mantra:'心如止水，意如明镜' },
{ name:'引气诀', icon:'fa-water', color:'spirit', desc:'引导灵气入体，开辟经脉', mantra:'意引灵气，循经而行' },
{ name:'五行功', icon:'fa-yin-yang', color:'gold', desc:'调和五脏，强健体魄', mantra:'金木水火土，五行相生相克' }
],
advanced: [
{ name:'筑基功', icon:'fa-mountain', color:'azure', desc:'气旋化液，筑建道基', mantra:'气旋化液，筑建道基' },
{ name:'结丹诀', icon:'fa-circle', color:'gold', desc:'道基化丹，金丹大成', mantra:'阴阳相济，坎离交媾' },
{ name:'婴成诀', icon:'fa-baby', color:'spirit', desc:'碎丹成婴，元婴出窍', mantra:'碎丹成婴，如婴儿新生' }
],
special: [
{ name:'剑修法门', icon:'fa-bolt', color:'paper', desc:'以剑为媒，炼剑成意', mantra:'以剑为媒，人剑合一' },
{ name:'符修法门', icon:'fa-scroll', color:'jade', desc:'以灵画符，符成法随', mantra:'一笔一划，皆含道韵' },
{ name:'阵修法门', icon:'fa-th', color:'azure', desc:'布阵困敌，聚灵养气', mantra:'天地为盘，万物为子' }
]
};

const alchemyData = {
dans: [
{ name:'聚气丹', color:'jade', desc:'加速灵气吸收三成', grade:'下品', price:'100灵石' },
{ name:'筑基丹', color:'azure', desc:'增加筑基成功率两成', grade:'中品', price:'1000灵石' },
{ name:'金丹丹', color:'gold', desc:'稳固金丹，防止碎裂', grade:'上品', price:'10000灵石' },
{ name:'元婴丹', color:'spirit', desc:'护持元婴初生', grade:'极品', price:'10万灵石' },
{ name:'回气丹', color:'jade', desc:'快速恢复灵气', grade:'下品', price:'50灵石' },
{ name:'疗伤丹', color:'vermilion', desc:'治愈内外伤势', grade:'下品', price:'80灵石' }
],
herbs: [
{ name:'千年人参', color:'spirit', desc:'蕴含庞大生命精华', age:'千年以上' },
{ name:'灵石', color:'gold', desc:'修真界通用货币', grade:'下中上极品' },
{ name:'朱果', color:'vermilion', desc:'服之可增加十年修为', age:'三百年成熟' },
{ name:'玄铁', color:'paper', desc:'炼制法宝上佳材料', grade:'中品灵材' }
],
formulas: [
{ name:'聚气丹方', color:'jade', materials:'灵草×3，聚灵花×1', method:'文火炼制三个时辰' },
{ name:'筑基丹方', color:'azure', materials:'天灵果×1，筑基草×5', method:'武火炼制七日七夜' }
]
};

const healthData = [
{ title:'子时养阴', icon:'fa-moon', color:'azure', desc:'23:00-1:00入睡滋养肾阴', xuanxue:'子时一阳生，阴极阳生', science:'肝脏排毒关键时期', tips:['睡前热水泡脚','保持卧室安静'] },
{ title:'卯时采气', icon:'fa-sun', color:'jade', desc:'5:00-7:00采天地阳气', xuanxue:'卯时阳气始生', science:'清晨空气含氧量高', tips:['起床后饮温水','配合吐纳之术'] },
{ title:'饮食调和', icon:'fa-utensils', color:'gold', desc:'五味入五脏，五色补五行', xuanxue:'五味调和，五脏得养', science:'均衡饮食助营养吸收', tips:['早餐宜温热','晚餐宜清淡'] },
{ title:'运动炼体', icon:'fa-running', color:'vermilion', desc:'动则生阳，静则生阴', xuanxue:'阳气升发驱除寒湿', science:'增强心肺功能', tips:['运动量循序渐进','持之以恒'] }
];

const legendData = [
{ name:'彭祖', icon:'彭', color:'gold', title:'寿八百载', desc:'善养生之术，创导引行气之法', quote:'道不在烦，心无烦，形无极，此可长生' },
{ name:'张三丰', icon:'丰', color:'spirit', title:'太极宗师', desc:'武当派创始人', quote:'太极者，无极而生，动静之机' },
{ name:'吕洞宾', icon:'吕', color:'jade', title:'纯阳祖师', desc:'八仙之一', quote:'一粒金丹吞入腹，始知我命不由天' },
{ name:'老子', icon:'老', color:'azure', title:'道家始祖', desc:'著《道德经》五千言', quote:'道可道，非常道' },
{ name:'葛洪', icon:'葛', color:'vermilion', title:'抱朴子', desc:'东晋道教学者', quote:'求长生，诀在于志' },
{ name:'陈抟', icon:'陈', color:'paper', title:'睡仙', desc:'以睡功闻名', quote:'至人之睡，先睡心，后睡眼' }
];

const wisdomQuestions = [
{ q:'「道生一，一生二，二生三，三生万物」何解？', opts:['道生万物','数学为本','一气化阴阳生万物'], ans:3 },
{ q:'「上善若水」何意？', opts:['水最善良','滋养万物而不争','要像水软弱'], ans:2 },
{ q:'「无为而无不为」何解？', opts:['什么都不做','顺应自然而为','消极等待'], ans:2 },
{ q:'「道法自然」何为自然？', opts:['山川河流','自然而然','随意而为'], ans:2 },
{ q:'「金丹大道」何为金丹？', opts:['黄金做的丹','内丹修炼所结','仙丹妙药'], ans:2 },
{ q:'「炼精化气」此为何功？', opts:['外丹术','内丹术','符箓术'], ans:2 }
];

// 状态变量
let currentPage = 'home';
let meditationTimer = null, meditationSeconds = 0, isMeditating = false;
let reactionTimer = null, reactionTimes = [];
let focusTimer = null, focusBest = 0;
let memorySeq = [], memoryPlayer = [], memoryLevel = 1, memoryBest = 0;
let wisdomIdx = 0, wisdomCorrect = 0, wisdomTotal = 0;

// 页面切换
function showPage(pageId) {
document.querySelectorAll('.page').forEach(p => { p.classList.remove('active'); });
document.querySelectorAll('.nav-link').forEach(n => { n.classList.remove('active'); });
document.getElementById('page-' + pageId).classList.add('active');
document.querySelectorAll('.nav-link').forEach(n => {
if (n.textContent.includes(getPageName(pageId))) n.classList.add('active');
});
currentPage = pageId;
window.scrollTo(0, 0);

// 初始化页面内容
if (pageId === 'realm') generateRealmList();
if (pageId === 'technique') showTechniqueTab('basic');
if (pageId === 'alchemy') showAlchemyTab('dans');
if (pageId === 'health') generateHealth();
if (pageId === 'legend') generateLegend();
if (pageId === 'practice') { generateTasks(); generateLog(); }
if (pageId === 'trial') { generateMemory(); loadWisdom(); }
}

function getPageName(id) {
const names = {home:'首页',realm:'境界体系',technique:'功法秘籍',alchemy:'丹药宝典',health:'养生之道',legend:'神仙列传',practice:'修行中心',trial:'试炼场'};
return names[id] || '';
}

function toggleMobileMenu() {
const nav = document.getElementById('mobileNav');
nav.classList.toggle('hidden');
}

// 弹窗
function showModal(title, content) {
document.getElementById('modalContent').innerHTML = `<h3 class="font-brush text-xl text-paper mb-4">${title}</h3>${content}<button class="btn-jade w-full mt-4" onclick="closeModal()">关闭</button>`;
document.getElementById('modal').classList.add('show');
}

function closeModal() {
document.getElementById('modal').classList.remove('show');
}

// 境界列表
function generateRealmList() {
let html = '';
for (const [k, d] of Object.entries(realmData)) {
html += `<div class="glass-card p-4 cursor-pointer" onclick="showRealmDetail('${k}')">
<div class="flex items-center gap-4">
<div class="w-14 h-14 rounded-full bg-${d.color}/20 flex items-center justify-center border border-${d.color}/30">
<span class="font-brush text-xl text-${d.color}">${d.icon}</span>
</div>
<div class="flex-grow">
<h3 class="font-brush text-lg text-paper">${d.name}</h3>
<p class="text-paper/60 text-sm">${d.desc}</p>
</div>
<div class="text-right">
<div class="text-paper/50 text-xs">寿元</div>
<div class="text-gold font-brush">${d.lifespan}</div>
</div>
</div>
</div>`;
}
document.getElementById('realmList').innerHTML = html;
}

function showRealmDetail(k) {
const d = realmData[k];
showModal(d.name, `
<div class="space-y-3">
<p class="text-paper/70">${d.desc}</p>
<div class="p-3 rounded-lg bg-ink/30"><span class="text-gold">寿元：</span>${d.lifespan}</div>
<div class="p-3 rounded-lg bg-ink/30"><span class="text-gold">下一境界：</span>${d.next}</div>
<div><span class="text-gold">境界阶段：</span><ul class="mt-2 space-y-1">${d.stages.map(s => `<li class="text-paper/60 text-sm">• ${s}</li>`).join('')}</ul></div>
<div><span class="text-gold">能力：</span><div class="flex flex-wrap gap-2 mt-2">${d.abilities.map(a => `<span class="px-2 py-1 rounded-full bg-${d.color}/20 text-${d.color} text-xs">${a}</span>`).join('')}</div></div>
</div>
`);
}

function showOrganModal(k) {
const d = organData[k];
showModal(d.name + '·' + d.element + '行', `
<div class="space-y-3">
<p class="text-paper/70">${d.desc}</p>
<p class="text-sm"><span class="text-jade">对应境界：</span>${d.realm}</p>
<p class="text-sm"><span class="text-gold">修炼之法：</span>${d.practice}</p>
</div>
`);
}

function showRealmInfo() { showRealmDetail('lianqi'); }

// 功法
function showTechniqueTab(tab) {
document.querySelectorAll('#page-technique button').forEach(b => {
b.classList.remove('bg-gold/10', 'border-gold/30', 'text-gold');
b.classList.add('border-paper/20', 'text-paper/60');
});
event.target.classList.add('bg-gold/10', 'border-gold/30', 'text-gold');
event.target.classList.remove('border-paper/20', 'text-paper/60');

const data = techniqueData[tab];
let html = '<div class="grid md:grid-cols-2 gap-4">' + data.map(t => `
<div class="glass-card p-4 cursor-pointer" onclick="showTechniqueDetail('${t.name}','${t.icon}','${t.color}','${t.desc}','${t.mantra}')">
<div class="flex items-center gap-3 mb-2">
<div class="w-10 h-10 rounded-lg bg-${t.color}/20 flex items-center justify-center">
<i class="fas ${t.icon} text-${t.color}"></i>
</div>
<div>
<h4 class="font-brush text-paper">${t.name}</h4>
</div>
</div>
<p class="text-paper/60 text-sm">${t.desc}</p>
</div>
`).join('') + '</div>';
document.getElementById('techniqueContent').innerHTML = html;
}

function showTechniqueDetail(name, icon, color, desc, mantra) {
showModal(name, `
<div class="space-y-3">
<p class="text-paper/70">${desc}</p>
<div class="p-3 rounded-lg bg-ink/30">
<h4 class="text-gold text-sm mb-2">功法口诀</h4>
<p class="text-paper/60">${mantra}</p>
</div>
</div>
`);
}

// 丹药
function showAlchemyTab(tab) {
document.querySelectorAll('#page-alchemy button').forEach(b => {
b.classList.remove('bg-gold/10', 'border-gold/30', 'text-gold');
b.classList.add('border-paper/20', 'text-paper/60');
});
event.target.classList.add('bg-gold/10', 'border-gold/30', 'text-gold');
event.target.classList.remove('border-paper/20', 'text-paper/60');

let html = '';
if (tab === 'dans') {
html = '<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">' + alchemyData.dans.map(d => `
<div class="glass-card p-4">
<div class="flex items-center gap-2 mb-2">
<i class="fas fa-circle text-${d.color}"></i>
<h4 class="font-brush text-paper">${d.name}</h4>
</div>
<p class="text-paper/60 text-sm mb-2">${d.desc}</p>
<div class="text-xs text-paper/40">${d.grade} | ${d.price}</div>
</div>
`).join('') + '</div>';
} else if (tab === 'herbs') {
html = '<div class="grid md:grid-cols-2 gap-4">' + alchemyData.herbs.map(h => `
<div class="glass-card p-4">
<h4 class="font-brush text-${h.color}">${h.name}</h4>
<p class="text-paper/60 text-sm">${h.desc}</p>
</div>
`).join('') + '</div>';
} else {
html = '<div class="space-y-3">' + alchemyData.formulas.map(f => `
<div class="glass-card p-4">
<h4 class="font-brush text-${f.color} mb-2">${f.name}</h4>
<p class="text-paper/50 text-xs mb-2">材料：${f.materials}</p>
<p class="text-paper/60 text-sm">${f.method}</p>
</div>
`).join('') + '</div>';
}
document.getElementById('alchemyContent').innerHTML = html;
}

// 养生
function generateHealth() {
document.getElementById('healthContent').innerHTML = healthData.map(h => `
<div class="glass-card p-5 mb-4">
<div class="flex items-start gap-4">
<div class="w-12 h-12 rounded-full bg-${h.color}/20 flex items-center justify-center flex-shrink-0">
<i class="fas ${h.icon} text-${h.color}"></i>
</div>
<div>
<h3 class="font-brush text-lg text-paper mb-2">${h.title}</h3>
<p class="text-paper/60 text-sm mb-3">${h.desc}</p>
<div class="grid md:grid-cols-2 gap-2 mb-3">
<div class="p-2 rounded bg-ink/30"><span class="text-jade text-xs">玄学：</span><span class="text-paper/50 text-xs">${h.xuanxue}</span></div>
<div class="p-2 rounded bg-ink/30"><span class="text-gold text-xs">科学：</span><span class="text-paper/50 text-xs">${h.science}</span></div>
</div>
<div class="text-xs text-paper/50">${h.tips.map(t => '•' + t).join(' ')}</div>
</div>
</div>
</div>
`).join('');
}

// 神仙列传
function generateLegend() {
document.getElementById('legendList').innerHTML = legendData.map(l => `
<div class="glass-card p-5">
<div class="flex items-start gap-4">
<div class="w-12 h-12 rounded-full bg-${l.color}/20 flex items-center justify-center">
<span class="font-brush text-xl text-${l.color}">${l.icon}</span>
</div>
<div>
<h3 class="font-brush text-lg text-paper">${l.name}</h3>
<p class="text-${l.color} text-xs mb-2">${l.title}</p>
<p class="text-paper/60 text-xs mb-2">${l.desc}</p>
<div class="p-2 rounded bg-ink/30"><span class="text-paper/50 text-xs">「${l.quote}」</span></div>
</div>
</div>
</div>
`).join('');
}

// 修行中心
function generateTasks() {
const tasks = [{n:'晨间吐纳',d:true},{n:'午时炼气',d:false},{n:'子时冥想',d:false}];
document.getElementById('dailyTasks').innerHTML = tasks.map(t => `
<div class="flex justify-between p-2 rounded bg-ink/30 text-xs">
<span><i class="fas ${t.d?'fa-check-circle text-jade':'fa-circle text-paper/20'} mr-1"></i>${t.n}</span>
<span class="${t.d?'text-jade':'text-paper/40'}">${t.d?'完成':'待完成'}</span>
</div>
`).join('');
}

function generateLog() {
const logs = [{t:'今日',c:'完成吐纳'},{t:'昨日',c:'修炼引气诀'}];
document.getElementById('practiceLog').innerHTML = logs.map(l => `
<div class="text-xs p-2 rounded bg-ink/20">
<div class="text-paper/70">${l.c}</div>
<div class="text-paper/30">${l.t}</div>
</div>
`).join('');
}

// 冥想
function startMeditation() {
if (isMeditating) return;
isMeditating = true;
meditationSeconds = 0;
document.getElementById('meditationStatus').textContent = '冥想中...';
document.getElementById('meditationStatus').className = 'text-gold text-xs';
document.getElementById('startMeditation').disabled = true;
document.getElementById('stopMeditation').disabled = false;
document.getElementById('stopMeditation').classList.remove('opacity-50');
meditationTimer = setInterval(() => {
meditationSeconds++;
const h = Math.floor(meditationSeconds/3600), m = Math.floor((meditationSeconds%3600)/60), s = meditationSeconds%60;
document.getElementById('meditationTimer').textContent = 
String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
}, 1000);
}

function stopMeditation() {
if (!isMeditating) return;
isMeditating = false;
clearInterval(meditationTimer);
document.getElementById('meditationStatus').textContent = '待机中';
document.getElementById('meditationStatus').className = 'text-jade text-xs';
document.getElementById('startMeditation').disabled = false;
document.getElementById('stopMeditation').disabled = true;
document.getElementById('stopMeditation').classList.add('opacity-50');

const mins = Math.floor(meditationSeconds/60);
const cur = parseInt(document.getElementById('progressText').textContent);
const nxt = Math.min(cur + mins, 100);
document.getElementById('progressText').textContent = nxt + '%';
document.getElementById('progressBar').style.width = nxt + '%';
if (nxt >= 100) {
document.getElementById('breakthroughs').textContent = parseInt(document.getElementById('breakthroughs').textContent) + 1;
document.getElementById('progressText').textContent = '0%';
document.getElementById('progressBar').style.width = '0%';
}
}

// 灵根测试
function startRootTest() {
showModal('灵根测试', `
<div class="space-y-4">
<p class="text-paper/60 text-sm">选择与你最契合的元素</p>
<div class="grid grid-cols-2 gap-3">
<button onclick="showRootResult('jade','木灵根','木主生发，修行木系功法事半功倍')" class="p-4 rounded-xl border border-jade/30 hover:bg-jade/10"><i class="fas fa-leaf text-jade text-xl"></i><div class="text-paper">木</div></button>
<button onclick="showRootResult('vermilion','火灵根','火主炽热，修行火系功法事半功倍')" class="p-4 rounded-xl border border-vermilion/30 hover:bg-vermilion/10"><i class="fas fa-fire text-vermilion text-xl"></i><div class="text-paper">火</div></button>
<button onclick="showRootResult('paper','金灵根','金主锋锐，修行金系功法事半功倍')" class="p-4 rounded-xl border border-paper/30 hover:bg-paper/10"><i class="fas fa-gem text-paper/80 text-xl"></i><div class="text-paper">金</div></button>
<button onclick="showRootResult('spirit','水灵根','水主柔韧，修行水系功法事半功倍')" class="p-4 rounded-xl border border-spirit/30 hover:bg-spirit/10"><i class="fas fa-water text-spirit text-xl"></i><div class="text-paper">水</div></button>
<button onclick="showRootResult('gold','土灵根','土主厚重，修行土系功法事半功倍')" class="p-4 rounded-xl border border-gold/30 hover:bg-gold/10"><i class="fas fa-mountain text-gold text-xl"></i><div class="text-paper">土</div></button>
<button onclick="showRootResult('azure','五行灵根','五行均衡，修行任何功法皆可')" class="p-4 rounded-xl border border-azure/30 hover:bg-azure/10"><i class="fas fa-yin-yang text-azure text-xl"></i><div class="text-paper">五行</div></button>
</div>
</div>
`);
}

function showRootResult(color, name, desc) {
showModal('测试结果', `
<div class="text-center">
<div class="w-16 h-16 mx-auto rounded-full bg-${color}/20 flex items-center justify-center mb-4">
<i class="fas fa-yin-yang text-${color} text-2xl"></i>
</div>
<h3 class="font-brush text-xl text-paper mb-2">${name}</h3>
<p class="text-paper/60">${desc}</p>
</div>
`);
}

// 反应测试
function startReactionGame() {
reactionTimes = [];
document.getElementById('reactionStatus').textContent = '等待灵光出现...';
document.getElementById('startReaction').disabled = true;
document.getElementById('stopReaction').disabled = false;
document.getElementById('stopReaction').classList.remove('opacity-50');

const delay = 2000 + Math.random() * 3000;
reactionTimer = setTimeout(() => {
document.getElementById('reactionStatus').textContent = '点击灵光！';
const t = document.getElementById('reactionTarget');
t.style.display = 'block';
t.style.left = (Math.random() * 180 + 20) + 'px';
t.style.top = (Math.random() * 120 + 20) + 'px';
t.onclick = hitReaction;
}, delay);
}

function hitReaction() {
reactionTimes.push(Date.now());
const t = document.getElementById('reactionTarget');
t.style.display = 'none';
document.getElementById('reactionCount').textContent = reactionTimes.length;
const avg = reactionTimes.length > 1 ? Math.round(reactionTimes.reduce((a,b)=>a+b,0)/reactionTimes.length) : reactionTimes[0];
document.getElementById('avgReaction').textContent = avg + 'ms';

if (reactionTimes.length < 5) {
document.getElementById('reactionStatus').textContent = '继续等待...';
setTimeout(() => {
document.getElementById('reactionStatus').textContent = '点击灵光！';
const t = document.getElementById('reactionTarget');
t.style.display = 'block';
t.style.left = (Math.random() * 180 + 20) + 'px';
t.style.top = (Math.random() * 120 + 20) + 'px';
t.onclick = hitReaction;
}, 1500 + Math.random() * 2000);
} else {
document.getElementById('reactionStatus').textContent = '测试完成！';
document.getElementById('reactionRank').textContent = avg < 300 ? '天神' : avg < 500 ? '金丹' : '凡人';
endReaction();
}
}

function stopReactionGame() { clearTimeout(reactionTimer); endReaction(); }

function endReaction() {
document.getElementById('startReaction').disabled = false;
document.getElementById('stopReaction').disabled = true;
document.getElementById('stopReaction').classList.add('opacity-50');
document.getElementById('reactionTarget').style.display = 'none';
}

// 定力测试
function startFocusGame() {
let sec = 0;
document.getElementById('startFocus').disabled = true;
document.getElementById('stopFocus').disabled = false;
document.getElementById('stopFocus').classList.remove('opacity-50');
document.getElementById('focusDistractions').innerHTML = '';

focusTimer = setInterval(() => {
sec++;
document.getElementById('focusTime').textContent = sec + '秒';
if (sec > focusBest) {
focusBest = sec;
document.getElementById('focusBest').textContent = sec + '秒';
}
document.getElementById('focusRank').textContent = sec >= 60 ? '天神' : sec >= 30 ? '金丹' : '凡人';

if (sec % 2 === 0) {
const d = document.createElement('div');
d.className = 'absolute text-paper/20 text-xs';
d.textContent = ['心魔','杂念'][Math.floor(Math.random()*2)];
d.style.left = Math.random()*100+'%';
d.style.top = Math.random()*100+'%';
document.getElementById('focusDistractions').appendChild(d);
setTimeout(() => d.remove(), 1500);
}
}, 1000);

document.getElementById('focusGame').onclick = () => stopFocusGame();
}

function stopFocusGame() {
clearInterval(focusTimer);
document.getElementById('startFocus').disabled = false;
document.getElementById('stopFocus').disabled = true;
document.getElementById('stopFocus').classList.add('opacity-50');
document.getElementById('focusDistractions').innerHTML = '';
}

// 记忆测试
function generateMemory() {
let html = '';
for (let i = 0; i < 16; i++) {
html += `<div class="aspect-square rounded-lg bg-ink/40 border border-paper/10 flex items-center justify-center text-transparent" data-idx="${i}" onclick="hitMemory(${i})"><i class="fas fa-question"></i></div>`;
}
document.getElementById('memoryGame').innerHTML = html;
}

function startMemoryGame() {
memorySeq = [];
memoryPlayer = [];
memoryLevel = 1;
document.getElementById('memoryLevel').textContent = 1;
document.getElementById('startMemory').disabled = true;
document.getElementById('stopMemory').disabled = false;
document.getElementById('stopMemory').classList.remove('opacity-50');
nextMemoryRound();
}

function nextMemoryRound() {
memoryPlayer = [];
memorySeq.push(Math.floor(Math.random() * 16));
document.getElementById('memoryLevel').textContent = memoryLevel;
document.getElementById('memoryRank').textContent = memoryLevel >= 5 ? '天神' : memoryLevel >= 3 ? '金丹' : '凡人';

let i = 0;
const flash = setInterval(() => {
if (i >= memorySeq.length) {
clearInterval(flash);
enableMemory();
return;
}
const c = document.querySelector(`[data-idx="${memorySeq[i]}"]`);
c.classList.add('bg-gold/20', 'text-gold');
c.innerHTML = '<i class="fas fa-yin-yang"></i>';
setTimeout(() => {
c.classList.remove('bg-gold/20', 'text-gold');
c.innerHTML = '<i class="fas fa-question"></i>';
c.classList.add('text-transparent');
}, 400);
i++;
}, 600);
}

function enableMemory() {
document.querySelectorAll('[data-idx]').forEach(c => {
c.onclick = function() {
const idx = parseInt(this.dataset.idx);
memoryPlayer.push(idx);
this.classList.add('bg-gold/20', 'text-gold');
this.innerHTML = '<i class="fas fa-yin-yang"></i>';
setTimeout(() => {
this.classList.remove('bg-gold/20', 'text-gold');
this.innerHTML = '<i class="fas fa-question"></i>';
this.classList.add('text-transparent');
}, 200);

if (memoryPlayer[memoryPlayer.length-1] !== memorySeq[memoryPlayer.length-1]) {
stopMemoryGame();
showModal('失败', `<p class="text-center text-paper/70">记忆阵法破解失败！关卡：${memoryLevel}</p>`);
return;
}
if (memoryPlayer.length === memorySeq.length) {
memoryLevel++;
if (memoryLevel > memoryBest) {
memoryBest = memoryLevel - 1;
document.getElementById('memoryBest').textContent = memoryBest;
}
setTimeout(nextMemoryRound, 800);
}
};
});
}

function stopMemoryGame() {
document.getElementById('startMemory').disabled = false;
document.getElementById('stopMemory').disabled = true;
document.getElementById('stopMemory').classList.add('opacity-50');
generateMemory();
}

// 悟性测试
function loadWisdom() {
const q = wisdomQuestions[wisdomIdx];
document.getElementById('wisdomQuestion').textContent = q.q;
document.getElementById('wisdomOptions').innerHTML = q.opts.map((o, i) => `
<button onclick="checkWisdom(${i+1})" class="w-full p-3 text-left rounded-lg bg-ink/30 hover:bg-gold/10 text-paper/70 text-sm border border-transparent hover:border-gold/20">${String.fromCharCode(65+i)}. ${o}</button>
`).join('');
}

function checkWisdom(ans) {
const q = wisdomQuestions[wisdomIdx];
wisdomTotal++;
if (ans === q.ans) wisdomCorrect++;
document.getElementById('wisdomCount').textContent = wisdomTotal;
document.getElementById('wisdomCorrect').textContent = Math.round(wisdomCorrect/wisdomTotal*100) + '%';
document.getElementById('wisdomRank').textContent = wisdomCorrect/wisdomTotal >= 0.8 ? '天神' : wisdomCorrect/wisdomTotal >= 0.6 ? '金丹' : '凡人';
wisdomIdx = (wisdomIdx + 1) % wisdomQuestions.length;
loadWisdom();
}

// 初始化
document.addEventListener('DOMContentLoaded', () => {
showPage('home');
});
</script>
</body>
</html>
